---
title: Публикация пакета в npm
description: Короткая заметка о том как правильно опубликовать npm пакет. 
date: 2020-01-04T17:00:00.000+00:00
---
В процессе вынесения [темы](https://github.com/Defite/gatsby-theme-defite/tree/master/gatsby-theme-defite "Gatsby Defite theme") моего блога в отдельный пакет в npm, я составил небольшой список полезных команд и утилит, необходимых для удобной публикации пакета.

И сразу же спойлер: для базовой публикации пакета (то есть, чтобы пакет попал в [https://registry.npmjs.org/](https://registry.npmjs.org/ "https://registry.npmjs.org/"), достаточно авторизоваться в npm и опубликовать пакет:

```bash
cd your_npm_package
...
npm adduser
...
npm publish
```

Так я и поступил, а когда решил прикрутить тулзу для генерации файла CHANGELOG.md, понял, что у меня абсолютно не настроены теги в git и любая тулза генерит описание последней версии, так как ничего не знает про прошлые версии.

Для начала зайдем в папку с пакетом и там выполним:

```bash
git log --pretty=oneline
```

Это покажет в удобном виде все коммиты. В соседнем окне терминала я выполнил:

```bash
git tag
```

Эта команда покажет все теги репозитория. Так как тегов нет, список будет пустой. Приступим к созданию тегов.

```bash
git tag -a v1.0.0 686f9b7b94c92c3e1845562ad59961a3c3772350
```

Локально создан тег `v1.0.0`, связанный с указанным нами хешом коммита. Важно помнить, что 1 тег = 1 коммит. То есть если у нас было три коммита с изменениями после последнего тега, то для добавления в новый тег всех трех коммитов, нужно указать последний.

По умолчанию обычный `git push` не отправляет теги в удаленный репозиторий. Для того, чтобы увидеть теги, например, на [github](https://github.com/), нужно сделать так:

```bash
git push origin v1.0.0
```

Чтобы отправить сразу несколько тегов:

```bash
git push origin --tags
```

Это была организационная часть, теперь можно заняться созданием простого CHANGELOG.md. Здесь я не стал заморачиваться с conventional changelog, а создал простейший файл, который просто описывает изменения в релизе, без разбиения на фиксы и фичи. Возможно, это будет сделано в дальнейшем.

Для создания файла изменений я использовал утилиту [auto-changelog](https://www.npmjs.com/package/auto-changelog). Можно поставить ее как дев-зависимость или как глобальный пакет. У меня она стоит как глобальный пакет:

```bash
yarn global add auto-changelog
//или
npm i -g auto-changelog
```

Для создания файла с изменениями я просто выполняю в консоли:

```bash
auto-changelog -p
```

Для большего удобства и автор пакета и я рекомендуем всё же ставить этот пакет как дев-зависимость, а также прописать в скриптах пакета в `package.json`:

```bash
"scripts": {
  "version": "auto-changelog -p && git add CHANGELOG.md"
}
```

Пример готового CHANGELOG.md можно посмотреть [здесь](https://github.com/Defite/gatsby-theme-defite/blob/master/gatsby-theme-defite/CHANGELOG.md).